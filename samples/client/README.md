# A2A Client Sample

This sample demonstrates a command-line client for interacting with A2A-compliant servers, including those built with the `@agenticdao/crypto-a2a-server` library. The client provides both an API client class and a command-line interface for testing A2A agents.

## Features

- **Command-line Interface**: Interactive terminal for conversational interaction with A2A agents
- **A2A Client Class**: Reusable TypeScript client for integrating with A2A servers in your own applications
- **Streaming Support**: Real-time streaming of agent responses
- **Artifact Handling**: Support for displaying artifacts generated by agents
- **Solana Authentication**: Built-in support for Solana wallet-based authentication

## Prerequisites

- Node.js v22.0+ or higher
- npm or yarn

## Installation

1. Clone the repository
2. Navigate to the `samples/client` directory
3. Install dependencies:
   ```bash
   npm install
   ```
4. (Optional) Create a `.env` file with your Solana wallet private key for authentication:
   ```
   WALLET_PRIVATE_KEY=your_private_key_in_base58
   ```

## Using the CLI

The command-line interface provides an interactive terminal for testing A2A agents.

```bash
npm run a2a:cli [server-url]
```

Where `server-url` is the URL of the A2A server you want to connect to. If not provided, it defaults to `http://localhost:12001`.

### CLI Commands

- **Regular text**: Send a message to the agent
- **/new**: Start a new conversation (generates a new task ID)
- **/exit** or **Ctrl+C**: Exit the client

### Example Session

```
A2A Terminal Client
Agent URL: http://localhost:41241
‚úì Agent Card Found:
  Name:        Weather Forecast Agent
  Description: Provides weather forecasts for cities around the world
  Version:     1.0.0
Starting Task ID: 550e8400-e29b-41d4-a716-446655440000
Enter messages, or use '/new' to start a new task.

You: What's the weather in London?

Weather Forecast Agent [15:42:30]: ‚è≥ Status: working
  Part 1: üìù Text: Checking weather forecast for London...

Weather Forecast Agent [15:42:32]: üìÑ Artifact Received: forecast.json (Index: 0)
  Part 1: üìä Data: {
    "city": "london",
    "forecast": {
      "description": "Rainy",
      "temperature": 62,
      "humidity": 80,
      "windSpeed": 12
    },
    "timestamp": "2023-10-28T15:42:32.123Z"
  }

Weather Forecast Agent [15:42:32]: ‚úÖ Status: completed
  Part 1: üìù Text: Weather Forecast for London:
- Conditions: Rainy
- Temperature: 62¬∞F
- Humidity: 80%
- Wind Speed: 12 mph

You: 
```

## Using the A2A Client in Your Code

The client library provides a reusable `A2AClient` class that implements the A2A protocol for making requests to A2A-compliant servers.

### Basic Usage

```typescript
import { A2AClient } from './client';

// Create a client instance
const client = new A2AClient('http://localhost:41241');

// Send a task and get the result
async function sendMessage() {
  const result = await client.sendTask({
    id: 'task-123',
    message: {
      role: 'user',
      parts: [{ type: 'text', text: 'Hello, agent!' }]
    }
  });
  
  console.log('Response:', result);
}

sendMessage();
```

### Streaming Responses

```typescript
import { A2AClient } from './client';

// Create a client instance
const client = new A2AClient('http://localhost:41241');

// Send a task and stream the results
async function streamResponses() {
  const stream = client.sendTaskSubscribe({
    id: 'task-456',
    message: {
      role: 'user',
      parts: [{ type: 'text', text: 'What is the weather in New York?' }]
    }
  });
  
  for await (const event of stream) {
    if (event && 'status' in event) {
      console.log('Status update:', event.status.state);
      if (event.status.message) {
        console.log('Message:', event.status.message);
      }
    } else if (event && 'artifact' in event) {
      console.log('Artifact:', event.artifact.name);
    }
  }
}

streamResponses();
```

### Getting Agent Information

```typescript
import { A2AClient } from './client';

// Create a client instance
const client = new A2AClient('http://localhost:41241');

// Get the agent's metadata
async function getAgentInfo() {
  const card = await client.agentCard();
  console.log('Agent Name:', card.name);
  console.log('Description:', card.description);
  console.log('Capabilities:', card.capabilities);
}

getAgentInfo();
```

## Authentication

The client includes Solana-based authentication support. To use this feature:

1. Create a `.env` file in the client directory
2. Add your Solana wallet private key:
   ```
   WALLET_PRIVATE_KEY=your_private_key_in_base58
   ```

The client will automatically sign all requests using your wallet's credentials.

## API Reference

### A2AClient Methods

- **constructor(baseUrl: string, fetchImpl?: typeof fetch)** - Create a new client instance
- **agentCard(): Promise<AgentCard>** - Get the agent's metadata
- **sendTask(params: TaskSendParams): Promise<Task | null>** - Send a task and wait for completion
- **sendTaskSubscribe(params: TaskSendParams): AsyncIterable<...>** - Send a task and stream updates
- **getTask(params: TaskQueryParams): Promise<Task | null>** - Get the current state of a task
- **cancelTask(params: TaskIdParams): Promise<Task | null>** - Cancel a running task
- **supports(capability: "streaming" | "pushNotifications"): Promise<boolean>** - Check if agent supports a capability

## License

This project is licensed under the MIT License.
